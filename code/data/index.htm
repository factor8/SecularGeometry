<!DOCTYPE html>
<html>
<head>
	<title>SG Lantern Control Panel</title>
	<meta charset="utf-8"/>
	<meta content="SG Lantern" name="apple-mobile-web-app-title"/>	
	<meta content="width=device-width,initial-scale=1.0" name="viewport"/>
	<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
	<link href="http://cdn.shopify.com/s/files/1/0901/3118/t/2/assets/favicon.ico?612725279125252275" rel="shortcut icon" type="image/x-icon"/>
	<style type="text/css">
		body {
			background:black;
			color:white;
			width:20em;
		}
		.wrap {
			width:;
		}
		.flash {
			color:black;
			background: white;
			/*height:3em;*/
			width:80%;
			text-align: center;
			margin: 2em;
			padding:2em;
		}
	</style>
	<script>
		var debug;
		var connection;
		var connected = 0;
		
		function init() {
		    debug = document.getElementById("debug");
		    // var connection = new WebSocket('ws://'+location.hostname+':81/', ['arduino']);
			connect();			
		}

		function testWebSocket() {
		    websocket = new WebSocket(wsUri);
		    websocket.onopen = function(evt) { onOpen(evt) };
		    websocket.onclose = function(evt) { onClose(evt) };
		    websocket.onmessage = function(evt) { onMessage(evt) };
		    websocket.onerror = function(evt) { onError(evt) };
		  }

		function connect() {
			
			console.log("Connecting...");
			connection = new WebSocket('ws://sg-lantern.local:81/', ['arduino']);		   
	    	connection.onopen = function () {  connection.send('Connected ' + new Date());connected=1; }; 
	    	connection.onclose = function(evt) { console.log('Socket closed'); connected=0; };
			connection.onerror = function (error) { console.log('Socket Error: ', error);};
			connection.onmessage = function (e) { console.log('Server: ', e.data);};

		}
		// var connection = new WebSocket('ws://'+location.hostname+':81/', ['arduino']);
		
		
		function flash() {  
			if (!connected)connect();
			
			
			// var g = parseInt(document.getElementById('g').value).toString(16);  
			// var b = parseInt(document.getElementById('b').value).toString(16);  
			// if(r.length < 2) { r = '0' + r; }   
			// if(g.length < 2) { g = '0' + g; }   
			// if(b.length < 2) { b = '0' + b; }   
			// var rgb = '#'+r+g+b;    
			// console.log('RGB: ' + rgb); 
			
			// connection.send(rgb); 

			connection.send("0");
			console.log('Flashing...'); 
		}
		function adjustBrightness() {
			if (!connected)connect();
			var b = parseInt(document.getElementById('b').value).toString(16);  
			connection.send("#"+b);
			console.log('Brightness: ' + b); 
		}
		function advance() {
			if (!connected)connect();
			var s = parseInt(document.getElementById('s').value).toString(16);  
			connection.send("!"+s);
			console.log('Selector: ' + s); 
		}

		init();
	</script>

</head>
<body>
	<div class="wrap">
		<div class="flash" name="flash" value="flash" onClick="flash();" ><p>Flash</p></div>	
		Brightness: <input id="b" type="range" min="0" max="100" step="1" onchange="adjustBrightness();" /><br /><br />
		Pattern: <input id="s" type="range" min="0" max="9" step="1" onchange="advance();" />
	</div> 
	<div id="debug"></div>
</body>
</html>